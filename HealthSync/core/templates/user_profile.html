{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3">
            <div class="card bg-light text-dark shadow-sm mb-3">
                <div class="card-body text-center">
                    <div class="position-relative d-inline-block">
                        <img src="{% if profile.profile_picture %}{{ profile.profile_picture.url }}{% else %}https://via.placeholder.com/100{% endif %}"
                             alt="Profile Picture" id="previewImage" class="rounded-circle mb-3"
                             style="width: 120px; height: 120px; border: 3px solid #4fa3db;">
                        <label for="profilePicture" class="position-absolute bottom-0 start-50 translate-middle-x bg-primary rounded-circle p-2" style="cursor: pointer;">
                            <i class="bx bx-camera text-white"></i>
                        </label>
                    </div>
                    <input type="file" class="d-none" id="profilePicture" name="profile_picture" accept="image/*" onchange="previewProfilePicture(event)">
                    <h5 class="card-title mt-3">{{ request.user.username }}</h5>
                </div>
            </div>

            <!-- Profile Options Section -->
            <ul class="list-group mb-3">
                <li class="list-group-item"><i class="bx bx-user"></i> <a href="javascript:void(0)" class="text-dark" onclick="showSection('viewProfile')">Personal Information</a></li>
                <li class="list-group-item"><i class="bx bx-calendar"></i> <a href="javascript:void(0)" class="text-dark" onclick="showSection('appointments')">Appointments</a></li>
                <li class="list-group-item"><i class="bx bx-package"></i> <a href="javascript:void(0)" class="text-dark" onclick="showSection('orders')">Orders</a></li>
                <li class="list-group-item"><i class="bx bx-droplet"></i> <a href="javascript:void(0)" class="text-dark" onclick="showSection('donationHistory')">Donation History</a></li>
            </ul>

            <!-- Legal & Support Section -->
            <ul class="list-group">
                <li class="list-group-item">
                    <i class="bx bx-file"></i>
                    <a href="{% url 'terms_conditions' %}" class="text-dark">Terms & Conditions</a>
                </li>
                <li class="list-group-item">
                    <i class="bx bx-shield"></i>
                    <a href="{% url 'privacy_policy' %}" class="text-dark">Privacy Policy</a>
                </li>
                <li class="list-group-item">
                    <i class="bx bx-refresh"></i>
                    <a href="{% url 'refund_policy' %}" class="text-dark">Return and Refund Policy</a>
                </li>
                <li class="list-group-item">
                    <i class="bx bx-help-circle"></i>
                    <a href="{% url 'faq' %}" class="text-dark">FAQ</a>
                </li>
                <li class="list-group-item">
                    <i class="bx bx-log-out"></i>
                    <a href="{% url 'logout' %}" class="text-dark">Logout</a>
                </li>
            </ul>
        </div>

        <!-- Content Area -->
        <div class="col-md-9">
            <!-- View Profile Section -->
            <div id="viewProfile" class="profile-section">
                <h5>Personal Information</h5>
                <form method="POST" action="{% url 'update_profile' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="username" class="form-label">Username <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="username" name="username" value="{{ request.user.username }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="emailAddress" class="form-label">Email Address <span class="text-danger">*</span></label>
                        <input type="email" class="form-control" id="emailAddress" name="email" value="{{ request.user.email }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="fullName" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="fullName" name="full_name" value="{{ request.user.first_name }} {{ request.user.last_name }}" placeholder="Enter full name">
                    </div>
                    <div class="mb-3">
                        <label for="mobileNumber" class="form-label">Mobile No</label>
                        <input type="text" class="form-control" id="mobileNumber" name="mobile_number" value="{{ profile.mobile_number }}" placeholder="+8801234567890">
                    </div>
                    <div class="mb-3">
                        <label for="gender" class="form-label">Gender</label>
                        <select class="form-select" id="gender" name="gender">
                            <option selected disabled>Choose</option>
                            <option value="Male" {% if profile.gender == "Male" %}selected{% endif %}>Male</option>
                            <option value="Female" {% if profile.gender == "Female" %}selected{% endif %}>Female</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="dob" class="form-label">Date of Birth</label>
                        <input type="date" class="form-control" id="dob" name="dob" value="{{ profile.dob|date:'Y-m-d' }}">
                    </div>
                    <div class="mb-3">
                        <label for="profilePicture" class="form-label">Profile Picture</label>
                        <input type="file" class="form-control" id="profilePictureInput" name="profile_picture" accept="image/*" onchange="previewProfilePicture(event)">
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Update Profile</button>
                </form>
            </div>

            <!-- Orders Section -->
            <div id="orders" class="profile-section d-none">
                <h4 class="mb-4">My Orders</h4>
                {% if orders %}
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in orders|dictsort:"id" %}
                            <tr>
                                <td>#{{ order.id }}</td>
                                <td>{{ order.created_at|date:"Y-m-d" }}</td>
                                <td>
                                    <span class="badge
                                            {% if order.status == 'Delivered' %} bg-success
                                            {% elif order.status == 'Canceled' %} bg-danger
                                            {% elif order.status == 'Pending' %} bg-warning text-dark
                                            {% elif order.status == 'Shipped' %} bg-info text-dark
                                            {% elif order.status == 'Refunded' %} bg-custom-purple text-dark
                                            {% else %} bg-secondary
                                            {% endif %}">
                                        {{ order.status }}
                                    </span>
                                </td>
                                <td>
                                    <a href="{% url 'order_confirmation' order.id %}" class="btn btn-outline-primary btn-sm me-2">
                                        View Details
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                <div class="text-center d-flex justify-content-center align-items-center" style="height: 200px;">
                    <div class="card shadow-sm text-center p-4" style="border: none; max-width: 400px;">
                        <div class="mb-3">
                            <i class="bx bx-package" style="font-size: 3rem; color: #6c757d;"></i>
                        </div>
                        <h6 class="text-muted">No Orders Placed</h6>
                        <p class="text-muted">You haven’t placed any orders yet. Once you place an order, it will appear here.</p>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Appointments Section -->
            <div id="appointments" class="profile-section d-none">
                <h5>Appointments</h5>
                <div class="d-flex justify-content-center align-items-center" style="height: 200px;">
                    <div class="card shadow-sm text-center p-4" style="border: none; max-width: 400px;">
                        <div class="mb-3">
                            <i class="bx bx-calendar-x" style="font-size: 3rem; color: #6c757d;"></i>
                        </div>
                        <h6 class="text-muted">No Appointments Scheduled</h6>
                        <p class="text-muted">You currently have no upcoming appointments. Check back later for updates.</p>
                    </div>
                </div>
            </div>

            <!-- Donation History Section -->
            <div id="donationHistory" class="profile-section d-none">
                <h5>Donation History</h5>
                <div class="d-flex justify-content-center align-items-center" style="height: 200px;">
                    <div class="card shadow-sm text-center p-4" style="border: none; max-width: 400px;">
                        <div class="mb-3">
                            <i class="bx bx-donate-heart" style="font-size: 3rem; color: #6c757d;"></i>
                        </div>
                        <h6 class="text-muted">No Donation History Found</h6>
                        <p class="text-muted">You haven’t made any donations yet. Your contributions will appear here.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function previewProfilePicture(event) {
        const reader = new FileReader();
        reader.onload = function(){
            const output = document.getElementById('previewImage');
            output.src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    }

    function showSection(sectionId) {
        document.querySelectorAll('.profile-section').forEach(section => {
            section.classList.add('d-none');
        });
        document.getElementById(sectionId).classList.remove('d-none');
    }
</script>

<style>
    .card-header {
        font-weight: 600;
        font-size: 1.1rem;
    }
    .badge {
        padding: 0.5em 0.75em;
        font-size: 0.9em;
    }
    .text-muted {
        font-size: 0.9rem;
    }
    .list-group-item {
        border: none;
    }
    .table th, .table td {
        vertical-align: middle;
    }
    .bg-custom-purple {
        background-color: #6f42c1; /* Purple color */
        color: white !important;
    }
</style>
{% endblock %}
